# Title
Этот проект является API библиотекой и решает круг типичных задач любой библиотеки.
Какие задачи решает:
1. Облегчает поиск нужных книг
2. Увеличивает поток читателей
3. Улучшает популярность библиотеки
4. Уменьшает количество физических поситителей
5. Разгружает библиотекаря
6. Упрощает учет книг
7. Упрощает отслеживание выданных книг


# How to use
## Для использования API нужно понимать, что есть 4 типа пользователей:
1. Администратор
2. Библиотекарь
3. Пользователь
4. Анонимный пользователь

## Описание:
1. Администратор может делать все и только он может создавать библиотекаря.
2. Библиотекарь может взаимодействовать так же со всей системой, но по опеределенным правилами.
3. Пользователь может только просматривать все таблицы, а так же брать книги если они есть в наличии и
создавать заявки на продление выданной книги.
4. Анонимный пользователь может только просматривать таблицы, не каких других действий он не может совершать.

## Администратор может:
1. Самое главное, Администратор может создавать библиотекаря и только он.
2. Все остальное.

## Библиотекарь может:
1. Cоздавать, просматривать, редактировать, удалять Книги.
2. Cоздавать, просматривать, редактировать, удалять Авторов.
3. Cоздавать, просматривать, редактировать, удалять Издателей.
4. Cоздавать, просматривать, редактировать, удалять Тома.
5. Cоздавать, просматривать, редактировать, удалять Жанры.
6. Открывать, просматривать, закрывать Выдачу книг.
7. Открывать, просматривать, принимать, отказывать заявки на Продление книг.

## Библиотекарь не может:
1. Создавать, редактировать, удалять любых пользователей включая себя.

## Пользователь может:
1. Открывать, просматривать, Выдачу книг.
2. Открывать, просматривать, заявку на Продление книг.
3. Создавать, просматривать, редактировать, удалять свой профиль.

## Пользователь не может:
1. Все остальное.

## Анонимный пользователь может:
1. Просматривать Книги, Авторов, Издателей, Жанры, Тома.

## Анонимный пользователь не может:
1. Все остальное.

# Rules
## Правила создания и обновления Книги:
1. Если книга опубликована - год ее написания не может быть больше ТЕКУЩЕГО.
2. Если книга не была опубликована - год ее написания может быть больше ТЕКУЩЕГО.
3. Если книга не была опубликована - она не может быть ЛИДЕРОМ продаж.
4. Если книга не была опубликована - она не может иметь ТИРАЖ.
5. Если у книги есть том - должен быть и номер присущей этой книги в ТОМЕ.
6. Поля обязательные: author, publisher, name, age_restriction, count_pages, year_published, genre, circulation.

## Правила создания и обновления Автора:
1. Поля имя и фамилия обязательны.
2. Поля имя и фамилия должны быть уникальной комбинацией.

## Правила создания и обновления Издателя:
1. Все поля обязательны.
2. Имя, телефон, Эмеил, URL, должны быть уникальны (то есть не повторяться).

## Правила создания и обновления Жанра:
1. Все поля обязательны.

## Правила создания и обновления Тома:
1. Все поля обязательны.

## Правила открытия выдачи книги:
1. Нельзя выдать одну и ту же книгу тому же пользователю,
если книга до сих пор не была возвращена.
2. Нельзя выдать книгу, если количество книг в библиотеке уже 0.

## Правила открытия заявления на продление выдачи книги:
1. Нельзя запросить продление, если заявление уже было подано и
оно до сих пор в статусе "wait" (то есть еще не было обработано библиотекарем).
2. Пользователь может открывать заявление только на свои книги которые были ему выданы.
3. Можно открывать заявления только на активную выдачу книги (то есть на ту которая еще не была возвращена).
4. Нельзя открывать заявление, если количество продлений уже 2 (можно продлевать только 2 раза).

## Правила обработки заявления на продления выдачи книги:
1. Одно заявление можно обработать только один раз, если статус заявление не 'wait' больше отвечать нельзя.


# Install
Проект находится под контролем системы контеризации Docker.

## Нужно заполнить файл .env всеми неоходимыми данными:
1. DB_PASSWORD: указать пароль от Базы данных.
2. POSTGRES_PASSWORD: продублировать предыдущий пункт.
3. YANDEX_HOST_USER: указать эмеил который будет занимать рассылкой сообщений.
4. YANDEX_PASSWORD_HOST: указать пароль от эмеила.

## Необходимо ввести команды:
1. docker-compose build
2. docker-compose up


# API URLS

## Книга
1. http://localhost/api/book/list/ GET - просмотр списка книг.
2. http://localhost/api/book/retrieve/"some_book_number"/ GET - просмотр книги.
3. http://localhost/api/book/create/ POST - создание книги.
4. http://localhost/api/book/update/"some_book_number"/ PATCH - обновление книги.
5. http://localhost/api/book/delete/"some_book_number"/ DELETE - удаление книги.

## Автор
1. http://localhost/api/author/list/ GET - просмотр списка авторов.
2. http://localhost/api/author/retrieve/"some_author_number"/ GET - просмотр автора.
3. http://localhost/api/author/create/ CREATE - создание автора.
4. http://localhost/api/author/update/"some_author_number"/ PATCH - обновление автора.
5. http://localhost/api/author/delete/"some_author_number"/ DELETE - удаление автора.

## Издатель
1. http://localhost/api/publisher/list/ GET - просмотр списка издателей.
2. http://localhost/api/publisher/retrieve/"some_publisher_number"/ GET - просмотр автора.
3. http://localhost/api/publisher/create/ CREATE - создание издателя.
4. http://localhost/api/publisher/update/"some_publisher_number"/ PATCH - обновление автора.
5. http://localhost/api/publisher/delete/"some_publisher_number"/ DELETE - удаление автора.

## Том
1. http://localhost/api/volume/list/ GET - просмотр списка томов.
2. http://localhost/api/volume/retrieve/"some_volume_number"/ GET - просмотр тома.
3. http://localhost/api/volume/create/ CREATE - создание тома.
4. http://localhost/api/volume/update/"some_volume_number"/ PATCH - обновление тома.
5. http://localhost/api/volume/delete/"some_volume_number"/ DELETE - удаление тома.

## Жанр
1. http://localhost/api/genre/list/ GET - просмотр списка жанров.
2. http://localhost/api/genre/retrieve/"some_genre_number"/ GET - просмотр жанра.
3. http://localhost/api/genre/create/ CREATE - создание жанра.
4. http://localhost/api/genre/update/"some_genre_number"/ PATCH - обновление жанра.
5. http://localhost/api/genre/delete/"some_genre_number"/ DELETE - удаление жанра.

## Выдача книг
1. http://localhost/api/order/open/"some_book_number"/ CREATE - открытие выдачи книги.
2. http://localhost/api/order/close/"some_order_number"/ DELETE - закрытие выдачи книги.
3. http://localhost/api/order/retrieve/"some_order_number"/ GET - просмотр выдачи.
4. http://localhost/api/order/list/ GET - просмотр списка выдач.

## Запрос на продление выдачи
1. http://localhost/api/extension/open/"some_order_number"/ CREATE - открытие заявление на продление.
2. http://localhost/api/extension/accept/"some_extension_number"/ PATCH - принятие продления.
3. http://localhost/api/extension/cancel/"some_extension_number"/ PATCH - отказ от продления.
4. http://localhost/api/extension/retrieve/"some_extension_number"/ GET - просмотр заявления.
5. http://localhost/api/extension/list/ GET - просмотра списка заявлений.


# Info
Данный проект готов для деплоя на настоящий сервер (не полный)

Сам проект состоит из ~2800 строк кода не считая тестов.
На созданиe проекта ушло ~ 14 дней (в основном ночью писал).

Тестов 101 штука (есть возможность написать больше).
Тестов написанно ~2500 строк кода.


# Future Plans

В дальнейшей работе есть цель улучшить оптимизацию, я пока не смог отследить одну проблему
связанную с тем что иногда к запросам добавляеся +5 секунд (я могу грешить на свой сетевой терминал),
работаю я на MacBook PRO M3 MAX на 64гиг оперативки.

Улучшения связанные с программой могут быть:
1. Добавление таблицы "Редакция".
2. Добавление таблицы "Должники" для санкций и штрафов.
3. Внедрение посторонего API для оплаты штрафов например: Stripe.
4. Логика связанная с снятием санкий по сигналу оплаты.
5. Онлайн книги.
6. Аудио книги.


# Summary

Данный проект принес мне много интересного опыта, мне было интересно писать этот проект и думать
про бизнес логику.
Так же спасибо семье что поддерживали меня.
